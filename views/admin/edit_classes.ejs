<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sửa lớp học</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>
  <div class="container mt-4">
    <h1>Sửa lớp học</h1>
    <a href="javascript:history.back()" class="btn btn-secondary mb-3">Quay lại</a>

    <form action="/admin/classes/edit/<%= editClass.id %>" method="POST">
      <div class="form-group">
        <label for="parent_name">Tên phụ huynh</label>
        <input type="text" class="form-control" id="parent_name" name="parent_name" value="<%= editClass.parent_name %>" required>
      </div>

            <div class="form-group">        <label for="phone">Số điện thoại</label>        <input type="tel" class="form-control" id="phone" name="phone" value="<%= editClass.phone %>" pattern="[0-9]{10}" maxlength="10" title="Vui lòng nhập đúng 10 số điện thoại" required>      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="mb-3">
            <label for="provinceClass" class="form-label">Thành phố</label>
            <select class="form-select" id="provinceClass" name="province" required>
              <!-- Dữ liệu sẽ được chèn tự động bởi JavaScript -->
            </select>
          </div>
        </div>
        <div class="col-md-6">
          <div class="mb-3">
            <label for="districtClass" class="form-label">Quận</label>
            <select class="form-select" id="districtClass" name="district" required>
              <!-- Dữ liệu sẽ được chèn tự động bởi JavaScript -->
            </select>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label for="specific_address">Địa chỉ cụ thể</label>
        <input type="text" class="form-control" id="specific_address" name="specific_address" value="<%= editClass.specific_address %>">
      </div>

      <div class="form-group">
        <label for="tutor_gender">Giới tính gia sư</label>
        <select class="form-control" id="tutor_gender" name="tutor_gender" required>
          <option value="any" <%= editClass.tutor_gender === 'any' ? 'selected' : '' %>>Không yêu cầu</option>
          <option value="male" <%= editClass.tutor_gender === 'male' ? 'selected' : '' %>>Nam</option>
          <option value="female" <%= editClass.tutor_gender === 'female' ? 'selected' : '' %>>Nữ</option>
        </select>
      </div>

            <div class="form-group">        <label for="sessions_per_week">Số buổi/tuần</label>        <input type="number" class="form-control" id="sessions_per_week" name="sessions_per_week" value="<%= editClass.sessions_per_week %>" required min="1" max="20" title="Vui lòng nhập số buổi từ 1 đến 20">      </div>      <div class="form-group">        <label for="fee_per_session">Học phí/buổi (VNĐ)</label>        <input type="number" class="form-control" id="fee_per_session" name="fee_per_session" value="<%= editClass.fee_per_session %>" required min="10000" max="10000000" step="1000" title="Vui lòng nhập học phí từ 10,000 đến 10,000,000 VNĐ">      </div>

      <div class="form-group">
        <label for="grade_id">Khối lớp</label>
        <select class="form-control" id="grade_id" name="grade_id" required>
          <% grades.forEach(function(grade) { %>
            <option value="<%= grade.id %>" <%= grade.id === editClass.grade_id ? 'selected' : '' %>><%= grade.name %></option>
          <% }); %>
        </select>
      </div>

      <div class="form-group">
        <label for="subject_id">Môn học</label>
        <select class="form-control" id="subject_id" name="subject_id" required>
          <% subjects.forEach(function(subject) { %>
            <option value="<%= subject.id %>" <%= subject.id === editClass.subject_id ? 'selected' : '' %>><%= subject.name %></option>
          <% }); %>
        </select>
      </div>

      <div class="form-group">
        <label for="description">Mô tả</label>
        <textarea class="form-control" id="description" name="description" rows="3"><%= editClass.description %></textarea>
      </div>

      <div class="form-group">
        <label for="status">Trạng thái</label>
        <select class="form-control" id="status" name="status" required>
          <option value="open" <%= editClass.status === 'open' ? 'selected' : '' %>>Đang mở</option>
          <option value="taken" <%= editClass.status === 'taken' ? 'selected' : '' %>>Đã nhận</option>
        </select>
      </div>

      <div class="form-group">
        <label for="learning_mode">Hình thức học</label>
        <select class="form-control" id="learning_mode" name="learning_mode" required>
          <option value="online" <%= editClass.learning_mode === 'online' ? 'selected' : '' %>>Online</option>
          <option value="offline" <%= editClass.learning_mode === 'offline' ? 'selected' : '' %>>Offline</option>
          <option value="both" <%= editClass.learning_mode === 'both' ? 'selected' : '' %>>Cả hai</option>
        </select>
      </div>

      <div class="form-group">
        <label for="is_active">Trạng thái hoạt động</label>
        <select class="form-control" id="is_active" name="is_active" required>
          <option value="1" <%= editClass.is_active === 1 ? 'selected' : '' %>>Hoạt động</option>
          <option value="0" <%= editClass.is_active === 0 ? 'selected' : '' %>>Không hoạt động</option>
        </select>
      </div>

      <button type="submit" class="btn btn-primary">Cập nhật</button>
              <a href="javascript:history.back()" class="btn btn-secondary">Hủy</a>
    </form>
  </div>

  <script>
    // Load provinces
    fetch('/api/provinces')
      .then(response => response.json())
      .then(provinces => {
        const provinceSelect = document.getElementById('provinceClass');
        provinces.forEach(province => {
          const option = document.createElement('option');
          option.value = province.name;
          option.textContent = province.name;
          if (province.name === '<%= editClass.province %>') {
            option.selected = true;
          }
          provinceSelect.appendChild(option);
        });
      });

    // Load districts when province is selected
    document.getElementById('provinceClass').addEventListener('change', function() {
      const province = this.value;
      const districtSelect = document.getElementById('districtClass');
      districtSelect.innerHTML = '<option value="">Chọn quận/huyện</option>';
      
      if (province) {
        fetch(`/api/districts?province=${encodeURIComponent(province)}`)
          .then(response => response.json())
          .then(districts => {
            districts.forEach(district => {
              const option = document.createElement('option');
              option.value = district.name;
              option.textContent = district.name;
              if (district.name === '<%= editClass.district %>') {
                option.selected = true;
              }
              districtSelect.appendChild(option);
            });
          });
      }
    });

        // Load initial districts if province is selected    const initialProvince = document.getElementById('provinceClass').value;    if (initialProvince) {      fetch(`/api/districts?province=${encodeURIComponent(initialProvince)}`)        .then(response => response.json())        .then(districts => {          const districtSelect = document.getElementById('districtClass');          districts.forEach(district => {            const option = document.createElement('option');            option.value = district.name;            option.textContent = district.name;            if (district.name === '<%= editClass.district %>') {              option.selected = true;            }            districtSelect.appendChild(option);          });        });    }    // Validation cho số điện thoại - chỉ cho phép nhập số    document.getElementById('phone').addEventListener('input', function(e) {      // Loại bỏ tất cả ký tự không phải số      this.value = this.value.replace(/[^0-9]/g, '');            // Giới hạn 10 số      if (this.value.length > 10) {        this.value = this.value.slice(0, 10);      }    });    // Validation cho số buổi/tuần    document.getElementById('sessions_per_week').addEventListener('input', function(e) {      const value = parseInt(this.value);      if (this.value !== '' && (isNaN(value) || value < 1 || value > 20)) {        this.setCustomValidity('Số buổi/tuần phải từ 1 đến 20');      } else {        this.setCustomValidity('');      }    });    // Validation cho học phí    document.getElementById('fee_per_session').addEventListener('input', function(e) {      const value = parseInt(this.value);      if (this.value !== '' && (isNaN(value) || value < 10000 || value > 10000000)) {        this.setCustomValidity('Học phí phải từ 10,000 đến 10,000,000 VNĐ');      } else {        this.setCustomValidity('');      }    });    // Form validation khi submit    document.querySelector('form').addEventListener('submit', function(e) {      const phone = document.getElementById('phone').value;      const sessionsPerWeek = document.getElementById('sessions_per_week').value;      const feePerSession = document.getElementById('fee_per_session').value;            // Kiểm tra số điện thoại      if (!/^[0-9]{10}$/.test(phone)) {        e.preventDefault();        alert('Số điện thoại phải gồm đúng 10 chữ số');        return false;      }            // Kiểm tra số buổi/tuần      const sessions = parseInt(sessionsPerWeek);      if (isNaN(sessions) || sessions < 1 || sessions > 20) {        e.preventDefault();        alert('Số buổi/tuần phải từ 1 đến 20');        return false;      }            // Kiểm tra học phí      const fee = parseInt(feePerSession);      if (isNaN(fee) || fee < 10000 || fee > 10000000) {        e.preventDefault();        alert('Học phí phải từ 10,000 đến 10,000,000 VNĐ');        return false;      }    });
  </script>
</body>
</html>